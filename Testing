<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Firebase Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:Arial;
  background:#111;
  color:#0f0;
  padding:20px;
}
button{
  padding:12px 20px;
  font-size:16px;
  cursor:pointer;
  margin-top:10px;
}
pre{
  background:#000;
  padding:10px;
  margin-top:15px;
  overflow:auto;
}
</style>
</head>

<body>

<h2>ðŸ”¥ Firebase Test Page</h2>

<button id="loginBtn">Google Login Test</button>
<button id="readBtn">Read Firestore Test</button>

<pre id="log">Waiting...</pre>

<script type="module">
import { auth, db } from "./firebase-config.js";
import {
  GoogleAuthProvider,
  signInWithPopup,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
  doc,
  setDoc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const log = (msg)=> {
  document.getElementById("log").textContent += "\n" + msg;
};

log("âœ… Firebase file loaded");

const provider = new GoogleAuthProvider();

document.getElementById("loginBtn").onclick = async ()=>{
  try{
    const res = await signInWithPopup(auth,provider);
    log("âœ… Login success: " + res.user.email);

    await setDoc(doc(db,"testUsers",res.user.uid),{
      email: res.user.email,
      time: new Date()
    });

    log("âœ… Firestore write success");
  }catch(e){
    log("âŒ Error: " + e.message);
  }
};

document.getElementById("readBtn").onclick = async ()=>{
  if(!auth.currentUser){
    alert("Login first");
    return;
  }
  const snap = await getDoc(doc(db,"testUsers",auth.currentUser.uid));
  if(snap.exists()){
    log("ðŸ“„ Firestore data: " + JSON.stringify(snap.data(),null,2));
  }else{
    log("âŒ No document found");
  }
};

onAuthStateChanged(auth,user=>{
  if(user){
    log("ðŸ‘¤ Logged in as: "+user.email);
  }
});
</script>

</body>
</html>
