<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel</title>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<style>
body{
 margin:0;
 font-family:Arial, sans-serif;
 background:#0f172a;
 color:white;
}
.header{
 background:#020617;
 padding:15px;
 text-align:center;
 font-size:20px;
 font-weight:bold;
}
.box{
 background:#020617;
 margin:15px;
 padding:15px;
 border-radius:10px;
}
h3{margin-top:0}
input,textarea,button{
 width:100%;
 padding:12px;
 margin-top:10px;
 border-radius:8px;
 border:none;
 font-size:15px;
}
button{
 background:#4f46e5;
 color:white;
 font-weight:bold;
}
button.danger{
 background:#dc2626;
}
.small{
 font-size:12px;
 color:#94a3b8;
 margin-top:5px;
}
</style>
</head>

<body>

<div class="header"> ADMIN PANEL</div>

<div class="box">
<h3> Room Code</h3>
<input id="roomCode" placeholder="Enter Room Code">
<button onclick="updateRoom()">Save Room Code</button>
<div class="small">Users ke dashboard / inbox me dikhega</div>
</div>

<div class="box">
<h3> Send Inbox Message</h3>
<input id="msgTitle" placeholder="Title">
<textarea id="msgBody" placeholder="Message"></textarea>
<button onclick="sendInbox()">Send Message</button>
<div class="small">Sab users ke inbox me show hoga</div>
</div>

<div class="box">
<h3> Weekly Reset</h3>
<button class="danger" onclick="weeklyReset()">RESET WEEKLY COINS</button>
<div class="small"> Sirf weeklyCoins reset honge</div>
</div>

<div class="box">
<button class="danger" onclick="logout()">Logout Admin</button>
</div>

<!-- Firebase config -->
<script src="firebase-config.js"></script>

<script>
const auth = firebase.auth();
const db   = firebase.firestore();

/* ===== ADMIN CHECK (Firestore based) ===== */
auth.onAuthStateChanged(async user=>{
 if(!user){
   location.href="index.html";
   return;
 }

 const adminDoc = await db.collection("admins").doc(user.uid).get();
 if(!adminDoc.exists){
   alert(" You are not admin");
   auth.signOut();
 }
});

/* ===== ROOM CODE ===== */
function updateRoom(){
 const code = document.getElementById("roomCode").value.trim();
 if(!code){ alert("Enter room code"); return; }

 db.collection("rewards").doc("current").set({
  roomCode: code,
  updatedAt: firebase.firestore.FieldValue.serverTimestamp()
 },{merge:true});

 alert(" Room code updated");
 document.getElementById("roomCode").value="";
}

/* ===== INBOX MESSAGE ===== */
function sendInbox(){
 const t = msgTitle.value.trim();
 const m = msgBody.value.trim();
 if(!t || !m){ alert("Fill title & message"); return; }

 db.collection("admin_inbox").add({
  title: t,
  message: m,
  createdAt: firebase.firestore.FieldValue.serverTimestamp()
 });

 alert(" Message sent");
 msgTitle.value="";
 msgBody.value="";
}

/* ===== WEEKLY RESET ===== */
async function weeklyReset(){
 if(!confirm("Weekly coins reset ho jayenge. Continue?")) return;

 const snap = await db.collection("users").get();
 snap.forEach(d=>{
  d.ref.update({ weeklyCoins: 0 });
 });

 alert(" Weekly reset done");
}

/* ===== LOGOUT ===== */
function logout(){
 auth.signOut().then(()=>location.href="index.html");
}
</script>

</body>
</html>
