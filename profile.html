<!DOCTYPE html>
<html>
<head>
<title>Complete Profile</title>
<meta name="viewport" content="width=device-width">
</head>
<body>

<h2>Complete Profile</h2>

<form id="form">
  <input id="whatsapp" placeholder="WhatsApp Number" required><br><br>

  <label><input type="radio" name="game" value="bgmi" required> BGMI</label><br>
  <label><input type="radio" name="game" value="freefire" required> Free Fire</label><br><br>

  <input id="bgmiId" placeholder="BGMI ID" style="display:none">
  <input id="freefireId" placeholder="Free Fire UID" style="display:none"><br><br>

  <button>Save</button>
</form>

<script type="module">
import { auth, db } from "./firebase-config.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

let user=null;

onAuthStateChanged(auth,u=>{
  if(!u) location.href="index.html";
  user=u;
});

document.querySelectorAll("input[name=game]").forEach(r=>{
  r.onchange=()=>{
    bgmiId.style.display = r.value==="bgmi"?"block":"none";
    freefireId.style.display = r.value==="freefire"?"block":"none";
  };
});

form.onsubmit=async e=>{
  e.preventDefault();
  const game=document.querySelector("input[name=game]:checked").value;
  const gameId=game==="bgmi"?bgmiId.value:freefireId.value;

  await updateDoc(doc(db,"users",user.uid),{
    whatsapp:whatsapp.value,
    game,
    gameId
  });

  location.href="dashboard.html";
};
</script>

</body>
</html>
